generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Single User table for ALL roles
model User {
  id       String   @id @default(uuid())
  email    String   @unique
  phone    String?
  password String
  name     String
  role     UserRole @default(PATIENT)

  // Auth & Security
  isActive      Boolean   @default(true)
  isVerified    Boolean   @default(false)
  resetToken    String?
  resetTokenExp DateTime?
  otpCode       String?
  otpExpiry     DateTime?
  lastLogin     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Admin        Admin?
  Doctor       Doctor?
  Receptionist Receptionist?
  Staff        Staff?

  @@index([email])
  @@index([phone])
  @@map("users")
}

model Admin {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Clinic Information
  clinicName   String
  location     String
  subsValidity DateTime // Subscription expiry

  // Optional clinic details
  clinicLogo  String?
  clinicPhone String?
  clinicEmail String?
  address     String?

  // Business details
  gstin     String? @unique // GST number
  panNumber String? @unique
  licenseNo String? // Medical establishment license

  // Settings
  workingHours String? // JSON: { "monday": "9AM-5PM", ... }

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([clinicName])
  @@index([subsValidity])
  @@map("admins")
}

enum UserRole {
  SUPER_ADMIN // Company level
  ADMIN // Clinic owner
  DOCTOR
  RECEPTIONIST
  STAFF
  PATIENT
}

model Doctor {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  qualification  String
  registrationNo String      @unique
  experience     String?
  salary         Int
  shift          Shift
  gender         GenderRoles
  department     String
  aadhaar        String      @unique
  address        String

  consultationFee  Int?
  availabilityDays String? // Could be JSON for future expansion
  documentUrl      String[] // File upload

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([department])
  @@index([gender])
  @@index([shift])
  @@index([createdAt])
  @@map("doctors")
}

enum GenderRoles {
  MALE
  FEMALE
  OTHERS
}

enum Shift {
  MORNING
  EVENING
  ROTATIONAL
}

model Receptionist {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Receptionist Details
  experience String?
  salary     Int
  shift      Shift
  gender     GenderRoles
  aadhaar    String      @unique
  address    String

  // Optional fields
  deskNumber  String?
  shiftTiming String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([shift])
  @@index([gender])
  @@map("receptionists")
}

model Staff {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Staff-specific details
  skill      String
  category   StaffCategory
  experience String?
  salary     Int
  shift      Shift
  gender     GenderRoles
  aadhaar    String        @unique
  address    String

  // Optional fields
  registrationNo String?
  department     String?
  staffCode      String?
  joiningDate    DateTime?
  roleBadge      String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([shift])
  @@index([department])
  @@map("staffs")
}

enum StaffCategory {
  NURSE
  LAB_TECH
  PHARMACY
  ATTENDANT
  CLEANING
  OTHER
}
